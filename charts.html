<!DOCTYPE html>
<html>

<!-- Mirrored from mbostock.github.com/d3/ex/choropleth.html by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 04 Feb 2012 16:43:26 GMT -->

<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<title>Loading data</title>
	<script type="text/javascript" src="d3.min.js"></script>
	<style type="text/css">
		div.tooltip {
			position: absolute;
			text-align: center;
			width: 60px;
			height: 28px;
			padding: 2px;
			font: 12px sans-serif;
			background: lightblue;
			border: 0px;
			border-radius: 8px;
			pointer-events: none;
		}
		body{
			background-color: white;
		}
		.selected{
			opacity: 1;
		}
		.unselected{
			opacity: 0.1;
		}
		.yaxis line{
  		stroke: black;
		}

		.yaxis path{
  		stroke: black;
		}
		.xaxis line{
  		stroke: black;
		}

		.xaxis path{
  		stroke: black;
		}

		.xaxis text{
		  fill: black;
		}
		.yaxis text{
			fill: black;
		}
	</style>
</head>

<body>
	<div align="center">
		<h1>Loading data</h1>
	</div>
	<div id='chart' align="center">
	</div>
</body>

<script type="text/javascript">
	var height=550;
	var width=550;
	var color = d3.scaleOrdinal(d3.schemeCategory10);

	var div = d3.select("body").append("div")
		.attr("class", "tooltip")
		.style("opacity", 0);

	var time_scale;
	var amount_scale;
	var max_value;
	var min_value;

	var data = [];	

	d3.csv("standardized_data.csv").then(function(rows) {
		max_value  = d3.max(rows, function(d){
			return Math.max.apply(Math, [+d.BILL_AMT1, +d.BILL_AMT2, +d.BILL_AMT3, +d.BILL_AMT4, +d.BILL_AMT5, +d.BILL_AMT6]);
		})

		min_value = d3.min(rows, function(d){
			return Math.min.apply(Math, [+d.BILL_AMT1, +d.BILL_AMT2, +d.BILL_AMT3, +d.BILL_AMT4, +d.BILL_AMT5, +d.BILL_AMT6]);
		})		

		draw_scatterplot(rows);
	});	

	
	function draw_line(d) {
			
		var key = d.ID
		
		var bill_values = [
			{x_axis: 100, y_axis: d.BILL_AMT1},
			{x_axis: 200, y_axis: d.BILL_AMT2},
			{x_axis: 300, y_axis: d.BILL_AMT3},
			{x_axis: 400, y_axis: d.BILL_AMT4},
			{x_axis: 500, y_axis: d.BILL_AMT5},
			{x_axis: 600, y_axis: d.BILL_AMT6},
		];
		
		var line_bill = d3.line()
			.x(function(d) { return time_scale(d.x_axis); })
			.y(function(d) { return amount_scale(d.y_axis); })			


		var g = d3.select("#line_chart")
				.append('g')
				.attr('id', key)
				
		g.append("path")
			.attr("d", line_bill(bill_values))
			.attr("stroke", "blue")
			.attr("stroke-width", 3)
			.attr("fill", "none");
			
		g.selectAll('circle')
            .data(bill_values)
            .enter()
            .append("circle")
            .attr('cx', function(d) {return time_scale(d.x_axis)})
            .attr('cy', function(d) {return amount_scale(d.y_axis)})
            .attr('r',5)
            .attr("stroke", "blue")
			.attr("stroke-width", 3);			
				            
		var pay_values = [
			{x_axis: 100, y_axis: d.PAY_AMT1},
			{x_axis: 200, y_axis: d.PAY_AMT2},
			{x_axis: 300, y_axis: d.PAY_AMT3},
			{x_axis: 400, y_axis: d.PAY_AMT4},
			{x_axis: 500, y_axis: d.PAY_AMT5},
			{x_axis: 600, y_axis: d.PAY_AMT6},
		];
		
		var line_pay = d3.line()
			.x(function(d) { return time_scale(d.x_axis); })
			.y(function(d) { return amount_scale(d.y_axis); })			


		var g = d3.select("#line_chart")
				.append('g')
				.attr('id', key)
				
		g.append("path")
			.attr("d", line_pay(pay_values))
			.attr("stroke", "green")
			.attr("stroke-width", 3)
			.attr("fill", "none");
			
		g.selectAll('circle')
            .data(pay_values)
            .enter()
            .append("circle")
            .attr('cx', function(d) {return time_scale(d.x_axis)})
            .attr('cy', function(d) {return amount_scale(d.y_axis)})
            .attr('r',5)
            .attr("stroke", "green")
			.attr("stroke-width", 3);	            
	}

	function draw_chart(data) {		
			
		var container_dimensions = {width: 900, height: 500},
			margins = {top: 10, right: 20, bottom: 30, left: 60},
			chart_dimensions = {
				width: container_dimensions.width - margins.left - margins.right,
				height: container_dimensions.height - margins.top - margins.bottom
			};
			
		time_scale = d3.scaleTime()
			.range([0, chart_dimensions.width])
			.domain([0, 600]);
		      
		amount_scale = d3.scaleLinear()
			.range([chart_dimensions.height, 0])
			.domain([min_value,max_value]);
			
		var time_axis = d3.axisBottom(time_scale)
		
		var amount_axis = d3.axisLeft(amount_scale)
		
		var line_chart = d3.select("body")
			.append("svg")
				.attr("width", container_dimensions.width)
				.attr("height", container_dimensions.height)
			.append("g")
				.attr("transform", "translate(" + margins.left + "," + margins.top + ")")
				.attr("id","line_chart");
			
		line_chart.append("g")
			.attr("class", "xaxis")
			.attr("transform", "translate(0," + chart_dimensions.height + ")")
			.call(time_axis)

		line_chart.append("g")
			.attr("class", "yaxis")
			.call(amount_axis)

	}

	function draw_scatterplot(rows) {
		rows=rows.sort(function(a,b){ return d3.ascending(a.target, b.target);});
		var x = d3.scaleLinear()
			.range([0, width-10]);

		var y = d3.scaleLinear()
			.range([height-10, 0]);
		var xAxis = d3.axisBottom(x);
		var yAxis = d3.axisLeft(y);
		var x = d3.scaleLinear()
			.domain(d3.extent(rows, function(d) {
				return +d.X1
			}))
			.range([10, width-10]);
		var y = d3.scaleLinear()
			.domain(d3.extent(rows, function(d) {
				return +d.X2
			}))
			.range([10, height-10]);

		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
			.append("g")
			.attr("transform", "translate("+50+","+(-50)+")")
			
		svg.selectAll("circle").data(rows).enter()
			.append("circle")
			.attr("cx", function(d) {
				return x(d.X1);
			})
			.attr("cy", function(d) {
				return height - x(d.X2);
			})
			.attr("r", "2")
			.attr("fill", function(d) {
				return color(d.target)
			})
			.attr("target", function(d) {
				return d.target
			})
			.attr("class","selected")
			.attr("identifier", function(d) {
				return d.ID;
			})
			.on("mouseover", function(d) {
				div.transition()
					.duration(200)
					.style("opacity", .9);
				div.html(d.ID)
					.style("left", (d3.event.pageX) + "px")
					.style("top", (d3.event.pageY - 28) + "px");
			})
			.on("mouseout", function(d) {
				div.transition()
					.duration(500)
					.style("opacity", 0);
			})
			.on("click", function(d) {
				draw_line(d);
			});


		svg.append("g")
			.attr("class", "xaxis")
			.attr("transform", "translate(0," + width + ")")
			.call(xAxis)
			.append("text")
			.attr("class", "label")
			.attr("x", width)
			.attr("y", height)
			.style("text-anchor", "start")
			.text("X1");

		svg.append("g")
			.attr("class", "yaxis")
			.call(yAxis)
			.append("text")
			.attr("class", "label")
			.attr("transform", "rotate(-90)")
			.attr("y", 6)
			.attr("dy", ".71em")
			.style("text-anchor", "start")
			.text("X2");

		var legend = d3.select("svg").selectAll(".legend")
			 .data(color.domain())
			 .enter().append("g")
			 .classed("legend", true)
			 .attr("transform", function(d, i) {
					 return "translate(0," + i * 20 + ")";
			 })
			 .attr("class", "selected");
			 
		legend.append("rect")
			.attr("x", width -140)
			.attr("y", 20)
			.attr("width", 12)
			.attr("height", 12)
			.style("fill", color)
			.on("click", function(t) {

				d3.selectAll("rect").attr("class","unselected");				
				d3.select(this).attr("class","selected");
				d3.selectAll("[label]").each(function() {
					var x = d3.select(this)
					console.log(x.text())
					if (t==0) {
						if (x.text() == "Correct") x.attr("class","selected")
						else x.attr("class","unselected")
					}
					else {
						if (x.text() == "Correct") x.attr("class","unselected")
						else x.attr("class","selected")
					}
				});
					
				d3.selectAll("circle").filter(function(d) { return d.target == t; }).attr("class","selected");
				d3.selectAll("circle").filter(function(d) { return d.target == !+t; }).attr("class","unselected");
			});
			
		legend.append("text")
			.attr("label","text_legend")
			.attr("x", width - 116)
			.attr("y", 20)
			.attr("dy", ".65em")
			.text(function(d) {
				if (d==0){
					return "Correct";
				}
				else{
					return "Default";
				}
			});
			
		draw_chart();
	}
</script>

</html>
